<!DOCTYPE html>
<html>
<head>
    <title>Onclick Test - Verbesserte Version fÃ¼r fehlende AbrechnungseintrÃ¤ge</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .missing-billing-item {
            display: inline-block;
            margin: 2px 5px 2px 0;
            padding: 3px 8px;
            background-color: #f8d7da;
            color: #721c24;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .missing-billing-item:hover {
            background-color: #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Onclick Test - Verbesserte Version fÃ¼r fehlende AbrechnungseintrÃ¤ge</h1>
        
        <div class="test-section info">
            <h3>ğŸ“‹ Test-Beschreibung</h3>
            <p>Diese Seite testet die verbesserte JavaScript-FunktionalitÃ¤t mit Event-Delegation fÃ¼r klickbare fehlende AbrechnungseintrÃ¤ge.</p>
            <p><strong>Verbesserungen:</strong></p>
            <ul>
                <li>âœ… Event-Delegation statt inline onclick</li>
                <li>âœ… JSON-basierte DatenÃ¼bertragung</li>
                <li>âœ… Besseres Error-Handling</li>
                <li>âœ… Robustere Livewire-Integration</li>
            </ul>
        </div>
        
        <div class="test-section warning">
            <h3>âš ï¸ Bekanntes Problem</h3>
            <p>Das ursprÃ¼ngliche Problem war, dass die onclick-FunktionalitÃ¤t auf der Live-Website nicht funktionierte. Die Ursachen waren:</p>
            <ul>
                <li>âŒ Komplexes JavaScript-Escaping</li>
                <li>âŒ Inline onclick-Handler</li>
                <li>âŒ FehleranfÃ¤llige Livewire-Integration</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ Test-Boxen (neue Implementierung)</h3>
            <p>Klicken Sie auf die folgenden Boxen, um die verbesserte FunktionalitÃ¤t zu testen:</p>
            
            <!-- Test 1: Normale Abrechnung -->
            <span class="missing-billing-item" 
                  data-contract='{"id":"018e8b8b-b5b8-7b8b-8b8b-8b8b8b8b8b8b","year":2025,"month":7,"title":"Abrechnung 2025-07 - Energieversorgung E.ON","contractTitle":"Energieversorgung E.ON","supplierName":"E.ON Energie Deutschland GmbH"}'>
                Energieversorgung E.ON (E.ON Energie Deutschland GmbH) - Juli 2025
            </span>
            
            <!-- Test 2: Abrechnung mit Sonderzeichen -->
            <span class="missing-billing-item" 
                  data-contract='{"id":"018e8b8b-b5b8-7b8b-8b8b-8b8b8b8b8b8c","year":2025,"month":6,"title":"Abrechnung 2025-06 - Stadtwerke MÃ¼nchen GmbH & Co. KG","contractTitle":"Stadtwerke MÃ¼nchen","supplierName":"Stadtwerke MÃ¼nchen GmbH & Co. KG"}'>
                Stadtwerke MÃ¼nchen GmbH & Co. KG - Juni 2025
            </span>
            
            <!-- Test 3: Abrechnung mit AnfÃ¼hrungszeichen -->
            <span class="missing-billing-item" 
                  data-contract='{"id":"018e8b8b-b5b8-7b8b-8b8b-8b8b8b8b8b8d","year":2025,"month":5,"title":"Abrechnung 2025-05 - \"Premium\" Energy Solutions","contractTitle":"Premium Energy","supplierName":"\"Premium\" Energy Solutions"}'>
                "Premium" Energy Solutions - Mai 2025
            </span>
        </div>
        
        <div class="test-section success">
            <h3>âœ… Erwartete Ergebnisse</h3>
            <ul>
                <li><strong>Test 1:</strong> Alert mit korrekten Daten fÃ¼r E.ON</li>
                <li><strong>Test 2:</strong> Alert mit korrekten Daten trotz Sonderzeichen (&)</li>
                <li><strong>Test 3:</strong> Alert mit korrekten Daten trotz AnfÃ¼hrungszeichen</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”§ Debug-Informationen</h3>
            <p>Ã–ffnen Sie die Browser-Entwicklertools (F12) und schauen Sie in die Konsole fÃ¼r detaillierte Debug-Ausgaben.</p>
            <button onclick="testConsoleOutput()">Console Test ausfÃ¼hren</button>
            <button onclick="testEventDelegation()">Event-Delegation testen</button>
        </div>
    </div>
    
    <script>
    // Event-Delegation fÃ¼r bessere Performance und ZuverlÃ¤ssigkeit
    document.addEventListener("DOMContentLoaded", function() {
        console.log("ğŸ“„ Verbesserte Test-Seite geladen");
        console.log("ğŸ¯ Event-Delegation wird initialisiert...");
        
        // Entferne vorherige Event-Listener falls vorhanden
        document.removeEventListener("click", handleMissingBillingClick);
        
        // FÃ¼ge Event-Listener hinzu
        document.addEventListener("click", handleMissingBillingClick);
        
        console.log("âœ… Event-Delegation erfolgreich initialisiert");
    });
    
    function handleMissingBillingClick(event) {
        // PrÃ¼fe ob das geklickte Element eine fehlende Abrechnung ist
        if (event.target.classList.contains("missing-billing-item")) {
            event.preventDefault();
            event.stopPropagation();
            
            console.log("ğŸ¯ Klick auf missing-billing-item erkannt");
            
            try {
                const contractData = JSON.parse(event.target.getAttribute("data-contract"));
                console.log("ğŸ“Š Contract-Daten erfolgreich geparst:", contractData);
                
                openCreateBillingModal(
                    contractData.id,
                    contractData.year,
                    contractData.month,
                    contractData.title
                );
            } catch (error) {
                console.error("âŒ Fehler beim Parsen der Contract-Daten:", error);
                alert("Fehler beim Laden der Vertragsdaten. Bitte versuchen Sie es erneut.");
            }
        }
    }
    
    function openCreateBillingModal(contractId, year, month, title) {
        console.log("ğŸš€ openCreateBillingModal aufgerufen mit:");
        console.log("  - Contract ID:", contractId);
        console.log("  - Jahr:", year);
        console.log("  - Monat:", month);
        console.log("  - Titel:", title);
        
        // Debug-Alert fÃ¼r Testzwecke
        alert("âœ… Klick erkannt!\n\nContract ID: " + contractId + "\nJahr: " + year + "\nMonat: " + month + "\nTitel: " + title);
        
        // Simuliere Livewire-Integration (in echter Anwendung)
        console.log("ğŸ“¡ In der echten Anwendung wÃ¼rde hier Livewire verwendet werden");
        console.log("ğŸ”„ Fallback: Ã–ffne Create-Seite in neuem Tab");
        
        const url = "/admin/supplier-contract-billings/create" +
            "?supplier_contract_id=" + encodeURIComponent(contractId) +
            "&billing_year=" + encodeURIComponent(year) +
            "&billing_month=" + encodeURIComponent(month) +
            "&title=" + encodeURIComponent(title);
        
        console.log("ğŸŒ URL wÃ¼rde geÃ¶ffnet werden:", url);
    }
    
    function testConsoleOutput() {
        console.log("ğŸ§ª Console Test gestartet");
        console.log("âœ… JavaScript funktioniert korrekt");
        console.log("ğŸ“Š Event-Delegation ist aktiv");
        alert("Console Test abgeschlossen - schauen Sie in die Entwicklertools!");
    }
    
    function testEventDelegation() {
        console.log("ğŸ§ª Event-Delegation Test");
        
        // Erstelle dynamisch ein neues Element
        const newElement = document.createElement('span');
        newElement.className = 'missing-billing-item';
        newElement.setAttribute('data-contract', JSON.stringify({
            id: 'test-id-123',
            year: 2025,
            month: 8,
            title: 'Test Abrechnung 2025-08',
            contractTitle: 'Test Contract',
            supplierName: 'Test Supplier'
        }));
        newElement.textContent = 'Dynamisch erstelltes Test-Element - August 2025';
        newElement.style.marginTop = '10px';
        newElement.style.display = 'block';
        
        // FÃ¼ge es zur Seite hinzu
        document.querySelector('.test-section:last-of-type').appendChild(newElement);
        
        console.log("âœ… Dynamisches Element erstellt - klicken Sie darauf um Event-Delegation zu testen");
        alert("Dynamisches Element erstellt! Scrollen Sie nach unten und klicken Sie auf das neue rosa Element.");
    }
    </script>
</body>
</html>